# RAG Document: `raw_ga4_sessions.csv`

## 1. Source Description & Gist

- **File Name**: `raw_ga4_sessions.csv`
- **Data Source**: Simulates user session data from **Google Analytics 4 (GA4)**.
- **High-Level Purpose**: This file represents typical web analytics data, tracking user sessions and attributing them to marketing campaigns. It serves as the top of the user behavior funnel, showing which campaigns are successfully driving users to the website.
- **Agent's Primary Goal**: To ingest this data, clean up its specific entropy (column names and malformed IDs), and use it as a bridge between high-level ad spend and more granular user events.

## 2. File Structure & Schema

### Clean Data Profile

In "clean" mode, the file is generated with a schema focused on sessions and conversions.

- **Location**: `data/raw_ga4_sessions.csv`
- **Schema**:
    - `date`: `DATE` (`YYYY-MM-DD`).
    - `session_id`: `TEXT`, A unique identifier for the user session.
    - `user_uid`: `TEXT`, A unique identifier for the user.
    - `campaign_id`: `TEXT`, The campaign that drove the session.
    - `conv_flag`: `INTEGER` (`0` or `1`), A flag indicating if a conversion occurred during the session.
- **Generation Logic**: The file contains **24,000 rows** generated by the `build_sessions()` function. The `conv_flag` is set to `1` with a 10% probability, simulating a 10% session conversion rate.

### Realistic Data Profile (with Entropy)

The `add_entropy.py` script applies two main transformations to this file.

- **Key Transformations**:
    1.  **Column Name Convention**: `date` is renamed to `event_date` and `session_id` is renamed to `sessionId` (camelCase).
    2.  **Malformed Session IDs**: For a random **3% of rows**, the `sessionId` is intentionally corrupted to simulate data quality issues. The corruption logic replaces the last 3 characters with the string `"_BAD"`.

- **Resulting Realistic Schema**:
    - `event_date`: `TEXT` (`YYYY-MM-DD` format).
    - `sessionId`: `TEXT` (Can contain malformed values).
    - `user_uid`: `TEXT`
    - `campaign_id`: `TEXT`
    - `conv_flag`: `INTEGER`

- **Example of Realistic Data**:

  | event_date | sessionId      | user_uid   | campaign_id | conv_flag |
  |------------|----------------|------------|-------------|-----------|
  | 2025-05-20 | abcdef1234     | user_a     | CID_f9e8d7  | 0         |
  | 2025-05-21 | bcdefg_BAD     | user_b     | CID_a1b2c3  | 1         |
  | 2025-05-22 | cdefgh4567     | user_c     | CID_c4d5e6  | 0         |

## 3. Key Challenges & Instructions for AI Agent

1.  **Column Name Mapping**: The agent must first map the column names to the standard internal schema.
    - `event_date` → `event_date`
    - `sessionId` → `session_id`
    - `user_uid` → `user_uid`
    - `campaign_id` → `campaign_id`
    - `conv_flag` → `is_conversion` (A more descriptive standard name).
2.  **Data Validation and Cleaning**: The agent's most important task for this file is to handle the `malformed` session IDs.
    - **Detection**: The agent should validate the `session_id` column. A simple rule could be to check the length of the ID or look for the `"_BAD"` suffix.
    - **Strategy**: The agent needs a strategy for these rows. Options include:
        - **Filtering**: Remove the rows with bad session IDs. This is the safest option if the session ID is critical for joins.
        - **Flagging**: Keep the rows but add a separate boolean column (e.g., `is_malformed_session`) to flag them for exclusion from certain analyses.
        - **Attempted Repair**: This is advanced, but an agent could attempt to repair the ID if a pattern is known (not possible here, as the original characters are lost).
    - For this dataset, **filtering** is the recommended approach.
3.  **Unification**: Once cleaned, this data serves as a key link. The `campaign_id` can be joined to the ad platforms' data, and the `user_uid` can be joined to the other analytics and CRM data. 