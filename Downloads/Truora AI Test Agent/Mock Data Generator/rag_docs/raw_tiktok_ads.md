# RAG Document: `raw_tiktok_ads.csv`

## 1. Source Description & Gist

- **File Name**: `raw_tiktok_ads.csv`
- **Data Source**: Simulates daily advertising performance from **TikTok Ads**.
- **High-Level Purpose**: This file tracks daily spend and performance for TikTok campaigns. It is a crucial source of ad spend data, but it is intentionally the "messiest" of the ad platform files to simulate the challenges of dealing with international data.
- **Agent's Primary Goal**: To ingest, clean, and standardize this complex file. The agent must handle multiple currencies, non-standard numeric formats, column name variations, and missing data to successfully unify this data with other sources.

## 2. File Structure & Schema

### Clean Data Profile

In "clean" mode, the file starts with the standard ad platform schema.

- **Location**: `data/raw_tiktok_ads.csv`
- **Initial Schema (before entropy)**:
    - `event_date`: `DATE` (`YYYY-MM-DD`)
    - `campaign_id`: `TEXT`
    - `cost_usd`: `DECIMAL`
    - `impressions`: `INTEGER`
    - `clicks`: `INTEGER`
- **Generation Logic**: The base data contains **1,800 rows** generated by the standard `build_ads()` function.

### Realistic Data Profile (with Entropy)

This file undergoes the most significant transformations in `add_entropy.py`.

- **Key Transformations**:
    1.  **Multi-Currency Introduction**: A `currency` column is added, randomly assigning `USD`, `COP` (Colombian Peso), or `MXN` (Mexican Peso) to each row.
    2.  **Local Cost Calculation**: A new `cost_local` column is created. The original `cost_usd` is multiplied by a fixed exchange rate (`COP: 4200`, `MXN: 17`) to get the cost in the local currency.
    3.  **Non-Standard Numeric Formatting**: The `cost_local` values are converted to strings with thousands separators to simulate real-world export formats.
        - **European Style**: For `COP` and `MXN`, it uses a format like `1.234.567,89`.
        - **US Style**: For `USD`, it uses a format like `1,234,567.89`.
    4.  **Column Renaming**: The columns are renamed, creating case and naming variations.
        - `cost_usd` → `Spend` (This column is then **dropped**).
        - `clicks` → `Clicks` (Capitalized).
        - `impressions` → `impressionsCount` (camelCase).
    5.  **Missing Data**: For a random **10% of rows**, the value in `impressionsCount` is replaced with an empty string `''`.

- **Resulting Realistic Schema**:
    - `date`: `TEXT` (`YYYY-MM-DD` format, but should be treated as text initially).
    - `campaign_id`: `TEXT`
    - `cost_local`: `TEXT` (string representation of cost, e.g., `'4.200.000,00'`).
    - `currency`: `TEXT` (`USD`, `COP`, `MXN`).
    - `impressionsCount`: `TEXT` (to accommodate empty strings).
    - `Clicks`: `INTEGER`.

## 3. Key Challenges & Instructions for AI Agent

1.  **Column Name Mapping**: The first step is to map the messy column names to a standard internal schema.
    - `date` → `event_date`
    - `campaign_id` → `campaign_id`
    - `cost_local` → `cost_usd` (The goal is to create a unified USD cost column).
    - `currency` → `currency`
    - `impressionsCount` → `impressions`
    - `Clicks` → `clicks`
2.  **Cost Standardization (Critical Path)**: This is the most complex task for this file.
    - **Parse `cost_local`**: The agent must first remove the thousands separators (`.` or `,`) and convert the decimal separator (`,` for European style) to a standard `.` to parse the string into a number.
    - **Currency Conversion**: After parsing, the agent must convert all `cost_local` values back to USD using the `currency` column and the inverse of the generation exchange rates.
        - `USD`: No change.
        - `COP`: Divide by `4200`.
        - `MXN`: Divide by `17`.
    - The final, standardized value should be stored in a `cost_usd` column.
3.  **Handle Missing Impressions**: The agent must scan the `impressionsCount` (`impressions`) column for empty strings and convert them to `NULL` or `0`. The column should then be cast to `INTEGER`.
4.  **Final Schema**: After all cleaning and standardization, the resulting data frame should have the standard ad platform schema (`event_date`, `campaign_id`, `cost_usd`, `impressions`, `clicks`) and be ready for unification. The `cost_local` and `currency` columns can be dropped after the `cost_usd` column is successfully created. 